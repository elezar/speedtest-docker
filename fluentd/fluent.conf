<source>
  type forward
  port 24224
  bind 0.0.0.0
</source>

<filter speedtest.*>
  @type parser
  format json
  key_name log
  # reserve_data true
</filter>

<filter speedtest.*>
  @type record_transformer
  <record>
    id "${tag_parts[1]}"
  </record>
  remove_keys "share"
</filter>

<match speedtest.*>
  type stdout
</match>

<match speedtest.*>
  type bigquery

  method insert

  auth_method json_key
  json_key /fluentd/etc/speedtest-fluentd.json

  project speedtest-lezar
  dataset speeds_test
  table speeds
  schema_path /fluentd/etc/bq-schema.json

  <inject>
    time_key timestamp
    time_type string
    time_format "%Y-%m-%dT%H:%M:%S.%L%Z"
  </inject>
</match>
